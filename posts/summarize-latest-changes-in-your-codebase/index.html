<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="ie=edge">
<meta name=theme-color content="#494f5c">
<meta name=msapplication-TileColor content="#494f5c">
<meta itemprop=name content="Summarize Latest Changes In Your Codebase">
<meta itemprop=description content="You are probably familiar with this workflow
 work on different stories pull requests are approved and merged deploy changes inform the team  For the last part, you check your todo list to get a nice description instead of some mysterious ID. You could do this manually, but this is very time-consuming, not to mention mind-numbing. Scripts to the rescue!
High level approach   Fetch the version information of the environment you want to deploy to."><meta itemprop=datePublished content="2021-06-27T12:33:00+02:00">
<meta itemprop=dateModified content="2021-06-27T12:33:00+02:00">
<meta itemprop=wordCount content="505">
<meta itemprop=keywords content><meta property="og:title" content="Summarize Latest Changes In Your Codebase">
<meta property="og:description" content="You are probably familiar with this workflow
 work on different stories pull requests are approved and merged deploy changes inform the team  For the last part, you check your todo list to get a nice description instead of some mysterious ID. You could do this manually, but this is very time-consuming, not to mention mind-numbing. Scripts to the rescue!
High level approach   Fetch the version information of the environment you want to deploy to.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.pieterjd.be/posts/summarize-latest-changes-in-your-codebase/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-06-27T12:33:00+02:00">
<meta property="article:modified_time" content="2021-06-27T12:33:00+02:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Summarize Latest Changes In Your Codebase">
<meta name=twitter:description content="You are probably familiar with this workflow
 work on different stories pull requests are approved and merged deploy changes inform the team  For the last part, you check your todo list to get a nice description instead of some mysterious ID. You could do this manually, but this is very time-consuming, not to mention mind-numbing. Scripts to the rescue!
High level approach   Fetch the version information of the environment you want to deploy to.">
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/site.webmanifest>
<link rel=mask-icon href=/safari-pinned-tab.svg color>
<link rel="shortcut icon" href=/favicon.ico>
<title>Summarize Latest Changes In Your Codebase</title>
<link rel=stylesheet href=https://www.pieterjd.be/css/style.min.037b6ee8f8c1baab6a3d0a9da11c3ff18a7552471f16c59fd98538d5ce99208b.css integrity="sha256-A3tu6PjBuqtqPQqdoRw/8Yp1UkcfFsWf2YU41c6ZIIs=" crossorigin=anonymous>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-132459675-1','auto'),ga('send','pageview'))</script>
</head>
<body id=page>
<header id=site-header class="animated slideInUp">
<div class="hdr-wrapper section-inner">
<div class=hdr-left>
<div class=site-branding>
<a href=https://www.pieterjd.be>pieterjd.be</a>
</div>
<nav class="site-nav hide-in-mobile">
<a href=https://www.pieterjd.be/posts/>Posts</a>
<a href=https://www.pieterjd.be/talks/>Talks</a>
<a href=https://www.pieterjd.be/about/>About</a>
</nav>
</div>
<div class="hdr-right hdr-icons">
<span class="hdr-social hide-in-mobile"><a href=https://www.linkedin.com/in/pieterjandrouillon/ target=_blank rel="noopener me" title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a href=https://github.com/pieterjd target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://twitter.com/pjdrouillon target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button>
</div>
</div>
</header>
<div id=mobile-menu class="animated fast">
<ul>
<li><a href=https://www.pieterjd.be/posts/>Posts</a></li>
<li><a href=https://www.pieterjd.be/talks/>Talks</a></li>
<li><a href=https://www.pieterjd.be/about/>About</a></li>
</ul>
</div>
<main class="site-main section-inner animated fadeIn faster">
<article class=thin>
<header class=post-header>
<div class=post-meta><span>Jun 27, 2021</span></div>
<h1>Summarize Latest Changes In Your Codebase</h1>
</header>
<div class=content>
<p>You are probably familiar with this workflow</p>
<ol>
<li>work on different stories</li>
<li>pull requests are approved and merged</li>
<li>deploy changes</li>
<li>inform the team</li>
</ol>
<p>For the last part, you check your todo list to get a nice description instead of some mysterious ID. You could do this manually, but this is very time-consuming, not to mention mind-numbing. Scripts to the rescue!</p>
<h2 id=high-level-approach>High level approach<a href=#high-level-approach class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2>
<ol>
<li>
<p>Fetch the version information of the environment you want to deploy to. If not yet available, I suggest you create a version endpoint and include the commit id of the lastest commit. If you work with the Java/Maven combo, then just include the <a href=https://github.com/git-commit-id/git-commit-id-maven-plugin>Git Commit ID Maven Plugin</a></p>
</li>
<li>
<p>Get all information from all commits starting from the commit id, retrieved from the version id up till the last one. Assuming you use git (and you should!) then you can use the following command</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash> git log &lt;commitIdFromVersionEndpoint&gt;..HEAD --format<span class=o>=</span>format:<span class=s2>&#34;%s&#34;</span>
</code></pre></div></li>
<li>
<p>Do some regex magic to extract the story id, task id, &mldr;.</p>
</li>
<li>
<p>Connect to your backlog (REST, commandline, &mldr;.) to retrieve the information of the story id</p>
</li>
<li>
<p>print on the console and copy to clipboard</p>
</li>
</ol>
<h2 id=example-script>Example script<a href=#example-script class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2>
<p>As I am a fan of powershell, this was my go to language to implement this workflow.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=c># --- helper functions ---</span>
<span class=c># get all commit messages starting from the given hash</span>
<span class=k>function</span> <span class=nb>get-commits</span><span class=p>(</span><span class=nv>$fromHash</span><span class=p>){</span>
  <span class=nv>$commits</span> <span class=p>=</span> <span class=p>&amp;</span> <span class=s2>&#34;git&#34;</span> <span class=p>@(</span><span class=s2>&#34;log&#34;</span><span class=p>,</span><span class=s2>&#34;$fromHash..HEAD&#34;</span><span class=p>,</span> <span class=s2>&#34;--format=format:&#34;&#34;%s&#34;&#34;&#34;</span><span class=p>)</span>
  <span class=k>return</span> <span class=nv>$commits</span>
<span class=p>}</span>

<span class=c># $ticketId: the Jira ticket id</span>
<span class=c># $prefix: prefix for the message that will be returned - empty by default</span>
<span class=k>function</span> <span class=nb>get-description</span><span class=p>(</span><span class=nv>$ticketId</span><span class=p>,</span><span class=nv>$prefix</span><span class=p>=</span><span class=s1>&#39;&#39;</span><span class=p>){</span>
<span class=nv>$url</span> <span class=p>=</span> <span class=s2>&#34;https://&lt;replace with jira url&gt;/rest/api/2/search?jql=issue={0}&amp;fields=summary,parent&#34;</span> <span class=o>-f</span> <span class=nv>$ticketId</span>
<span class=nv>$response</span> <span class=p>=</span> <span class=p>(</span><span class=nb>curl </span><span class=n>-u</span> <span class=p>&lt;</span><span class=n>your</span> <span class=n>credential</span><span class=p>&gt;</span> <span class=nv>$url</span> <span class=n>-s</span><span class=p>)</span> <span class=p>|</span> <span class=nb>ConvertFrom-json</span>

<span class=nv>$summary</span> <span class=p>=</span> <span class=nv>$response</span><span class=p>.</span><span class=n>issues</span><span class=p>.</span><span class=n>fields</span> <span class=p>|</span> <span class=nb>select </span><span class=n>-ExpandProperty</span> <span class=n>summary</span>
<span class=k>return</span> <span class=s2>&#34;{0}{1} - {2}&#34;</span> <span class=o>-f</span> <span class=nv>$prefix</span><span class=p>,</span><span class=nv>$ticketId</span><span class=p>,</span><span class=nv>$summary</span>
<span class=p>}</span>

<span class=c># Step 1: get version endpoint and get the hash of the latest deployed commit</span>
<span class=nv>$shortCommitId</span> <span class=p>=</span> <span class=p>(</span><span class=nb>Invoke-RestMethod</span> <span class=n>https</span><span class=err>:</span><span class=p>//&lt;</span><span class=n>replace</span> <span class=n>with</span> <span class=n>your</span> <span class=n>own</span> <span class=n>endpoint</span><span class=p>&gt;/</span><span class=n>version</span><span class=p>).</span><span class=n>gitHash</span>

<span class=c># Step 2: pull in latest changes and get all commit messages</span>
<span class=n>git</span> <span class=n>checkout</span> <span class=n>develop</span>
<span class=n>git</span> <span class=n>pull</span>
<span class=nv>$commits</span> <span class=p>=</span> <span class=nb>get-commits</span><span class=p>(</span><span class=nv>$shortCommitId</span><span class=p>)</span>

<span class=c># step 3: keep commit messages containing qntc, the Jira project key</span>
<span class=nv>$commits</span> <span class=p>=</span> <span class=nv>$commits</span> <span class=p>|?{</span><span class=nv>$_</span> <span class=o>-like</span> <span class=s1>&#39;*qntc*&#39;</span><span class=p>}</span>
<span class=c># start building the message as an array of strings</span>
<span class=nv>$msg</span> <span class=p>=</span> <span class=p>@(</span><span class=s2>&#34;Starting deploy to int. Deploy includes: &#34;</span><span class=p>)</span>
<span class=c># Step 4: retrieve the story description</span>
<span class=c># typical powershell one-liner:</span>
<span class=c># - Loop over all commits and check for QNTC prefix</span>
<span class=c># - Sort the found prefixes</span>
<span class=c># - Select the unique values</span>
<span class=c># - Fetch the story description for each unique value</span>
<span class=c># the array of the unique story description is prefixed with &#39;* &#39;, and are then appended to the $msg array</span>
<span class=nv>$msg</span> <span class=p>+=</span> <span class=p>(</span><span class=nv>$commits</span> <span class=p>|%{</span><span class=k>if</span><span class=p>(</span><span class=nv>$_</span> <span class=o>-match</span> <span class=s1>&#39;QNTC[SUP]*-\d+&#39;</span><span class=p>)</span> <span class=p>{</span><span class=nv>$Matches</span><span class=p>[</span><span class=n>0</span><span class=p>]}}</span> <span class=p>|</span> <span class=n>sort</span><span class=p>|</span> <span class=nb>select </span><span class=n>-unique</span> <span class=p>|</span> <span class=p>%{</span><span class=nb>get-description</span> <span class=nv>$_</span> <span class=s1>&#39;* &#39;</span><span class=p>})</span>
<span class=c># copy the message to the clipboard</span>
<span class=nv>$msg</span> <span class=p>|</span> <span class=n>pbcopy</span>
<span class=nb>Write-Host</span> <span class=s1>&#39;copied to clipboard&#39;</span>

</code></pre></div><p>That&rsquo;s it! I&rsquo;m sure you can implement this in your favourite scripting language</p>
<h2 id=references>References<a href=#references class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2>
<ul>
<li><a href=https://github.com/git-commit-id/git-commit-id-maven-plugin>Maven Git Commit ID Plugin</a></li>
<li><a href=https://git-scm.com/docs/git-log>Git Log command</a></li>
<li><a href=https://docs.microsoft.com/en-us/learn/modules/introduction-to-powershell/>Introduction to Powershell</a> - <a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/deep-dives/everything-about-string-substitutions?view=powershell-7.1">Everything you wanted to know about variable substitution in strings in Powershell</a></li>
<li><a href=https://www.atlassian.com/blog/jira-software/jql-the-most-flexible-way-to-search-jira-14>Getting started with JQL</a> - <a href=https://support.atlassian.com/jira-service-management-cloud/docs/use-advanced-search-with-jira-query-language-jql/>Advanced Search with JQL</a></li>
</ul>
</div>
<hr class=post-end>
<footer class=post-info>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>505 Words</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2021-06-27 10:33 +0000</p>
</footer>
</article>
<div class="post-nav thin">
<a class=next-post href=https://www.pieterjd.be/posts/reduce-docker-ps-clutter-with-awk/>
<span class=post-nav-label><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>&nbsp;Newer</span><br><span>Reduce docker ps Output Clutter with AWK</span>
</a>
<a class=prev-post href=https://www.pieterjd.be/posts/templating/>
<span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>Templating as Automation</span>
</a>
</div>
<div id=comments class=thin>
</div>
</main>
<footer id=site-footer class="section-inner thin animated fadeIn faster">
<p>&copy; 2022 <a href=https://www.pieterjd.be>Pieter-Jan Drouillon</a> &#183; <a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></p>
<p>
Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://www.pieterjd.be/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a>
</p>
</footer>
<script src=https://www.pieterjd.be/js/bundle.min.7d8545daa55d62427355498dd8da13f98ff79a7938ce7d2a5e2ae1ec0de3beb8.js integrity="sha256-fYVF2qVdYkJzVUmN2NoT+Y/3mnk4zn0qXirh7A3jvrg=" crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-132459675-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</body>
</html>