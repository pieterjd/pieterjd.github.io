<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Templating as Automation | pieterjd.be</title>
<meta name=keywords content="Automation,Templating">
<meta name=description content="Templating is a powerful tool to save time on tedious tasks!">
<meta name=author content>
<link rel=canonical href=https://www.pieterjd.be/posts/templating/>
<meta name=google-site-verification content="MN3Sf5TrdFo5j8qHAiXG2_gF0P1tXmClJN0JX8TvqgU">
<link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.pieterjd.be/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://www.pieterjd.be/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://www.pieterjd.be/favicon-32x32.png>
<link rel=apple-touch-icon href=https://www.pieterjd.be/apple-touch-icon.png>
<link rel=mask-icon href=https://www.pieterjd.be/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-132459675-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="Templating as Automation">
<meta property="og:description" content="Templating is a powerful tool to save time on tedious tasks!">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.pieterjd.be/posts/templating/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-04-17T19:33:17+02:00">
<meta property="article:modified_time" content="2022-07-30T21:46:07+02:00">
<meta property="og:see_also" content="https://www.pieterjd.be/posts/automate-aem-development/"><meta property="og:see_also" content="https://www.pieterjd.be/posts/automate-angular-material-workflow-with-schematics/"><meta property="og:see_also" content="https://www.pieterjd.be/posts/automate-timesheeting/">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Templating as Automation">
<meta name=twitter:description content="Templating is a powerful tool to save time on tedious tasks!">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://www.pieterjd.be/posts/"},{"@type":"ListItem","position":3,"name":"Templating as Automation","item":"https://www.pieterjd.be/posts/templating/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Templating as Automation","name":"Templating as Automation","description":"Templating is a powerful tool to save time on tedious tasks!","keywords":["Automation","Templating"],"articleBody":"In this post, I’ll cover different examples of what I like to call templating. Doing the same over and over again, but only few parts change each iteration.\nEnvironment Variables While working on integrating an API, I had to authenticate with a Bearer token in the authentication header. These tokens are typically short-lived, so they change multiple times a day.\nAs part of the integration, I write down the API calls in Typora, a very nice markdown editor. I really like I can add code snippets that are being highlighted, it’s easy to work with, so it’s an ideal tool for taking notes that I can later refer to. A typical entry would be like this:\nhttp 'Authentication: Bearer 123456789...XYZ' http: //www.example.com A typical workflow is copying the call from my markdown notes and execute them in the shell. Off course the bearer token has expired in the meantime, so I have to request a new token, update my notes and copy again.\nAnd then it hit me: why not replace the bearer token in my notes with environment variables? That way I can just copy and paste the command, and if the token is expired, I can just update it without changing my notes.\nexport TOKEN=123456789...XYZ # update the bearer token if expired http \"Authentication: Bearer $TOKEN\" http://www.example.com SQL statement generation Currently working on a new Java application with typical user roles.\nFor developing and testing purposes it is useful to have a dedicated user for each role. In this particular case this requires a row to be added to the user and user_roles tables. Not that hard, but there are 5 roles, for each role 2 queries meaning a total of 10 queries that differ on only a few places, being the email address and the credential value.\nsqlinsertinto`user`(email,password,is_active,created_at,updated_at)values('admin@example.com',sha1('pass'),1,now(),now());insertintouser_credential(user_id,credential,value,created_at,updated_at)values(LAST_INSERT_ID(),'admin',1,now(),now());So it is Powershell to the rescue, more specific the templating functionality.\nIn powershell you can define placeholders between curly brackets around an index (zero-based). Next you can format the template while providing the values for each placeholder - the -f is shorthand for format and then you provide all values separated by commas. This $_ is a special variable in powershell, it is the currently processed value of the array. In the first iteration, it will have the value admin, the next iteration the value press, and so on.\n$sql_template = @\" insert into `user` (email, password, is_active, created_at, updated_at) values('{0}@example.com', sha1('pass'), 1, now(), now() ); insert into user_credential (user_id,credential,value,created_at,updated_at) values (LAST_INSERT_ID(),'{0}',1,now(),now()); \"@ # loop over roles array and provide each one of them to the template. @('admin','press','super-admin','mice','spot') |%{$sql_template -f $_} Of course this does not work on all environments because the list of user roles is different for each environment. So you can rewrite this Powershell template with an actual SQL statement, using the CONCATfunction. It does not look pretty, but it gets the job done.\nSELECTdistinctuc.credentialasc,CONCAT(\"insert into `user` ( email, password, is_active, created_at, updated_at) values('\",credential,\"@emakina.com', sha1('pass'), 1, now(), now());\")ascommandfromuser_credentialucUNIONSELECTdistinctuc.credentialasc,CONCAT(\"insert into user_credential (user_id, credential, value, created_at, updated_at) values (LAST_INSERT_ID(), '\",credential,\"', 1, now(), now());\")ascommandfromuser_credentialucorderbyc;Conclusion Templating can help a lot with reducing annoying tasks. Powershell (or any language/tool that supports some kind of templating) is a great help, if not available, CONCAT functions go a long way as well\nReferences  Environment variables: Bash (Linux / Mac) - DOS / Windows Introduction to Powershell - Everything you wanted to know about variable substitution in strings in Powershell  Download Powershell: Mac Windows Linux   (My)SQL Concat - (My)SQL Group Concat  ","wordCount":"577","inLanguage":"en","datePublished":"2021-04-17T19:33:17+02:00","dateModified":"2022-07-30T21:46:07+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.pieterjd.be/posts/templating/"},"publisher":{"@type":"Organization","name":"pieterjd.be","logo":{"@type":"ImageObject","url":"https://www.pieterjd.be/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://www.pieterjd.be accesskey=h title="pieterjd.be (Alt + H)">pieterjd.be</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=https://www.pieterjd.be/posts/ title=Posts>
<span>Posts</span>
</a>
</li>
<li>
<a href=https://www.pieterjd.be/talks/ title=Talks>
<span>Talks</span>
</a>
</li>
<li>
<a href=https://www.pieterjd.be/about/ title=About>
<span>About</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Templating as Automation
</h1>
<div class=post-description>
Templating is a powerful tool to save time on tedious tasks!
</div>
<div class=post-meta><span title="2021-04-17 19:33:17 +0200 +0200">April 17, 2021</span>
</div>
</header>
<div class=post-content><p>In this post, I&rsquo;ll cover different examples of what I like to call <em>templating</em>. Doing the same over and over again, but only few parts change each iteration.</p>
<h2 id=environment-variables>Environment Variables<a hidden class=anchor aria-hidden=true href=#environment-variables>#</a></h2>
<p>While working on integrating an API, I had to authenticate with a Bearer token in the authentication header. These tokens are typically short-lived, so they change multiple times a day.</p>
<p>As part of the integration, I write down the API calls in <code>Typora</code>, a very nice markdown editor. I really like I can add code snippets that are being highlighted, it&rsquo;s easy to work with, so it&rsquo;s an ideal tool for taking notes that I can later refer to. A typical entry would be like this:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>http <span class=s1>&#39;Authentication: Bearer 123456789...XYZ&#39;</span> http: //www.example.com
</code></pre></div><p>A typical workflow is copying the call from my markdown notes and execute them in the shell. Off course the bearer token has expired in the meantime, so I have to request a new token, update my notes and copy again.</p>
<p>And then it hit me: why not replace the bearer token in my notes with environment variables? That way I can just copy and paste the command, and if the token is expired, I can just update it without changing my notes.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=nb>export</span> <span class=nv>TOKEN</span><span class=o>=</span>123456789...XYZ <span class=c1># update the bearer token if expired</span>
http <span class=s2>&#34;Authentication: Bearer </span><span class=nv>$TOKEN</span><span class=s2>&#34;</span> http://www.example.com
</code></pre></div><h2 id=sql-statement-generation>SQL statement generation<a hidden class=anchor aria-hidden=true href=#sql-statement-generation>#</a></h2>
<p>Currently working on a new Java application with typical user roles.</p>
<p>For developing and testing purposes it is useful to have a dedicated user for each role. In this particular case this requires a row to be added to the <code>user</code> and <code>user_roles</code> tables. Not that hard, but there are 5 roles, for each role 2 queries meaning a total of 10 queries that differ on only a few places, being the <code>email</code> address and the <code>credential</code> value.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=k>sql</span><span class=w> </span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=o>`</span><span class=k>user</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=n>email</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=p>,</span><span class=w> </span><span class=n>is_active</span><span class=p>,</span><span class=w> </span><span class=n>created_at</span><span class=p>,</span><span class=w> </span><span class=n>updated_at</span><span class=p>)</span><span class=w> </span><span class=k>values</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;admin@example.com&#39;</span><span class=p>,</span><span class=w> </span><span class=n>sha1</span><span class=p>(</span><span class=s1>&#39;pass&#39;</span><span class=p>),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=n>now</span><span class=p>(),</span><span class=w> </span><span class=n>now</span><span class=p>()</span><span class=w> </span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>user_credential</span><span class=w> </span><span class=p>(</span><span class=n>user_id</span><span class=p>,</span><span class=n>credential</span><span class=p>,</span><span class=n>value</span><span class=p>,</span><span class=n>created_at</span><span class=p>,</span><span class=n>updated_at</span><span class=p>)</span><span class=w> </span><span class=k>values</span><span class=w> </span><span class=p>(</span><span class=n>LAST_INSERT_ID</span><span class=p>(),</span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>now</span><span class=p>(),</span><span class=n>now</span><span class=p>());</span><span class=w>
</span></code></pre></div><p>So it is Powershell to the rescue, more specific the templating functionality.</p>
<p>In powershell you can define placeholders between curly brackets around an index (zero-based). Next you can format the template while providing the values for each placeholder - the <code>-f</code> is shorthand for <code>format</code> and then you provide all values separated by commas. This <code>$_</code> is a special variable in powershell, it is the currently processed value of the array. In the first iteration, it will have the value <code>admin</code>, the next iteration the value <code>press</code>, and so on.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=nv>$sql_template</span> <span class=p>=</span> <span class=sh>@&#34;
</span><span class=sh>insert into `user`
</span><span class=sh>(email, password, is_active, created_at, updated_at)
</span><span class=sh>values(&#39;{0}@example.com&#39;, sha1(&#39;pass&#39;), 1, now(), now() );
</span><span class=sh>
</span><span class=sh>insert into user_credential
</span><span class=sh>(user_id,credential,value,created_at,updated_at)
</span><span class=sh>values (LAST_INSERT_ID(),&#39;{0}&#39;,1,now(),now());
</span><span class=sh>&#34;@</span>

<span class=c># loop over roles array and provide each one of them to the template.</span>
<span class=p>@(</span><span class=s1>&#39;admin&#39;</span><span class=p>,</span><span class=s1>&#39;press&#39;</span><span class=p>,</span><span class=s1>&#39;super-admin&#39;</span><span class=p>,</span><span class=s1>&#39;mice&#39;</span><span class=p>,</span><span class=s1>&#39;spot&#39;</span><span class=p>)</span>
  <span class=p>|%{</span><span class=nv>$sql_template</span> <span class=o>-f</span> <span class=nv>$_</span><span class=p>}</span>
</code></pre></div><p>Of course this does not work on all environments because the list of user roles is different for each environment. So you can rewrite this Powershell template with an actual SQL statement, using the <code>CONCAT</code>function. It does not look pretty, but it gets the job done.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=k>SELECT</span><span class=w> </span><span class=k>distinct</span><span class=w> </span><span class=n>uc</span><span class=p>.</span><span class=n>credential</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=k>c</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=n>CONCAT</span><span class=p>(</span><span class=s2>&#34;insert into `user` ( email, password,
</span><span class=s2>is_active, created_at, updated_at)
</span><span class=s2>values(&#39;&#34;</span><span class=p>,</span><span class=w>  </span><span class=n>credential</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;@emakina.com&#39;, sha1(&#39;pass&#39;),
</span><span class=s2>1, now(), now());&#34;</span><span class=p>)</span><span class=w>
</span><span class=w></span><span class=k>as</span><span class=w> </span><span class=n>command</span><span class=w>
</span><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>user_credential</span><span class=w> </span><span class=n>uc</span><span class=w>
</span><span class=w></span><span class=k>UNION</span><span class=w>
</span><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=k>distinct</span><span class=w> </span><span class=n>uc</span><span class=p>.</span><span class=n>credential</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=k>c</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=n>CONCAT</span><span class=p>(</span><span class=s2>&#34;insert into user_credential (user_id, credential,
</span><span class=s2>value, created_at, updated_at)
</span><span class=s2>values (LAST_INSERT_ID(), &#39;&#34;</span><span class=p>,</span><span class=w>  </span><span class=n>credential</span><span class=p>,</span><span class=s2>&#34;&#39;, 1, now(), now());&#34;</span><span class=p>)</span><span class=w>
</span><span class=w></span><span class=k>as</span><span class=w> </span><span class=n>command</span><span class=w>
</span><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>user_credential</span><span class=w> </span><span class=n>uc</span><span class=w>
</span><span class=w></span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=k>c</span><span class=p>;</span><span class=w>
</span></code></pre></div><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2>
<p>Templating can help a lot with reducing annoying tasks. Powershell (or any language/tool that supports some kind of templating) is a great help, if not available, CONCAT functions go a long way as well</p>
<h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2>
<ul>
<li>Environment variables: <a href=https://www.shell-tips.com/bash/environment-variables/>Bash (Linux / Mac)</a> - <a href=https://ss64.com/nt/syntax-variables.html>DOS / Windows</a></li>
<li><a href=https://docs.microsoft.com/en-us/learn/modules/introduction-to-powershell/>Introduction to Powershell</a> - <a href="https://docs.microsoft.com/en-us/powershell/scripting/learn/deep-dives/everything-about-string-substitutions?view=powershell-7.1">Everything you wanted to know about variable substitution in strings in Powershell</a>
<ul>
<li>Download Powershell: <a href="https://docs.microsoft.com/en-us/powershell/scripting/install/installing-powershell-core-on-macos?view=powershell-7.1">Mac</a> <a href="https://docs.microsoft.com/en-us/powershell/scripting/install/installing-powershell-core-on-windows?view=powershell-7.1">Windows</a> <a href="https://docs.microsoft.com/en-us/powershell/scripting/install/installing-powershell-core-on-linux?view=powershell-7.1">Linux</a></li>
</ul>
</li>
<li><a href=https://dev.mysql.com/doc/refman/8.0/en/string-functions.html#function_concat>(My)SQL Concat</a> - <a href=https://dev.mysql.com/doc/refman/8.0/en/aggregate-functions.html#function_group-concat>(My)SQL Group Concat</a></li>
</ul>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://www.pieterjd.be/tags/automation/>Automation</a></li>
<li><a href=https://www.pieterjd.be/tags/templating/>Templating</a></li>
</ul>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://www.pieterjd.be>Pieter-Jan Drouillon</a></span>
<span> . </span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>