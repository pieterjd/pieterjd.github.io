<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Proper JMS conversion to POJOs | pieterjd.be</title>
<meta name=keywords content="Spring Boot,JMS,MessageConverter,Azure Service Bus">
<meta name=description content="While looking into Azure Service bus with Spring Boot, I stumbled upon a nasty stacktrace caused by an IllegalArgumentException:
java.lang.IllegalArgumentException: Property name must not be null So what is going on here?
Setup I configured a queue persons on Azure service bus and in my spring boot application I defined a QueueListener using the @JmsListener annotation
@Component public class PersonQueueListener { private static final String QUEUENAME=&#34;persons&#34;; @JmsListener(destination = QUEUENAME) public void receiveMessage(Person person) throws JsonProcessingException { log.">
<meta name=author content>
<link rel=canonical href=https://www.pieterjd.be/posts/jms-property-name-must-not-be-null/>
<meta name=google-site-verification content="MN3Sf5TrdFo5j8qHAiXG2_gF0P1tXmClJN0JX8TvqgU">
<link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.pieterjd.be/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://www.pieterjd.be/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://www.pieterjd.be/favicon-32x32.png>
<link rel=apple-touch-icon href=https://www.pieterjd.be/apple-touch-icon.png>
<link rel=mask-icon href=https://www.pieterjd.be/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-132459675-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="Proper JMS conversion to POJOs">
<meta property="og:description" content="While looking into Azure Service bus with Spring Boot, I stumbled upon a nasty stacktrace caused by an IllegalArgumentException:
java.lang.IllegalArgumentException: Property name must not be null So what is going on here?
Setup I configured a queue persons on Azure service bus and in my spring boot application I defined a QueueListener using the @JmsListener annotation
@Component public class PersonQueueListener { private static final String QUEUENAME=&#34;persons&#34;; @JmsListener(destination = QUEUENAME) public void receiveMessage(Person person) throws JsonProcessingException { log.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.pieterjd.be/posts/jms-property-name-must-not-be-null/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-06-14T20:17:40+00:00">
<meta property="article:modified_time" content="2022-08-19T09:07:24+02:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Proper JMS conversion to POJOs">
<meta name=twitter:description content="While looking into Azure Service bus with Spring Boot, I stumbled upon a nasty stacktrace caused by an IllegalArgumentException:
java.lang.IllegalArgumentException: Property name must not be null So what is going on here?
Setup I configured a queue persons on Azure service bus and in my spring boot application I defined a QueueListener using the @JmsListener annotation
@Component public class PersonQueueListener { private static final String QUEUENAME=&#34;persons&#34;; @JmsListener(destination = QUEUENAME) public void receiveMessage(Person person) throws JsonProcessingException { log.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://www.pieterjd.be/posts/"},{"@type":"ListItem","position":3,"name":"Proper JMS conversion to POJOs","item":"https://www.pieterjd.be/posts/jms-property-name-must-not-be-null/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Proper JMS conversion to POJOs","name":"Proper JMS conversion to POJOs","description":"While looking into Azure Service bus with Spring Boot, I stumbled upon a nasty stacktrace caused by an IllegalArgumentException:\njava.lang.IllegalArgumentException: Property name must not be null So what is going on here?\nSetup I configured a queue persons on Azure service bus and in my spring boot application I defined a QueueListener using the @JmsListener annotation\n@Component public class PersonQueueListener { private static final String QUEUENAME=\u0026#34;persons\u0026#34;; @JmsListener(destination = QUEUENAME) public void receiveMessage(Person person) throws JsonProcessingException { log.","keywords":["Spring Boot","JMS","MessageConverter","Azure Service Bus"],"articleBody":"While looking into Azure Service bus with Spring Boot, I stumbled upon a nasty stacktrace caused by an IllegalArgumentException:\njava.lang.IllegalArgumentException: Property name must not be null So what is going on here?\nSetup I configured a queue persons on Azure service bus and in my spring boot application I defined a QueueListener using the @JmsListener annotation\n@Component public class PersonQueueListener { private static final String QUEUENAME=\"persons\"; @JmsListener(destination = QUEUENAME) public void receiveMessage(Person person) throws JsonProcessingException { log.info(\"Received Person {} on Service Bus\", person); } } Somehow I expected this to work - after all the Person class was filled with Jackson annotations. However, exceptions were flying around with the only clue Property name must not be null.\nRoot cause org.springframework.jms.listener.adapter.ListenerExecutionFailedException: Listener method 'public void com.example.demo.PersonQueueListener.receiveMessage(com.example.demo.Person) throws com.fasterxml.jackson.core.JsonProcessingException' threw exception; nested exception is java.lang.IllegalArgumentException: Property name must not be null at org.springframework.jms.listener.adapter.MessagingMessageListenerAdapter.invokeHandler(MessagingMessageListenerAdapter.java:122) ~[spring-jms-5.3.20.jar:5.3.20] at org.springframework.jms.listener.adapter.MessagingMessageListenerAdapter.onMessage(MessagingMessageListenerAdapter.java:77) ~[spring-jms-5.3.20.jar:5.3.20] at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:736) ~[spring-jms-5.3.20.jar:5.3.20] at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:696) ~[spring-jms-5.3.20.jar:5.3.20] at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:674) ~[spring-jms-5.3.20.jar:5.3.20] at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:331) ~[spring-jms-5.3.20.jar:5.3.20] at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:270) ~[spring-jms-5.3.20.jar:5.3.20] at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1237) ~[spring-jms-5.3.20.jar:5.3.20] at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1227) ~[spring-jms-5.3.20.jar:5.3.20] at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:1120) ~[spring-jms-5.3.20.jar:5.3.20] at java.base/java.lang.Thread.run(Thread.java:833) ~[na:na] Caused by: java.lang.IllegalArgumentException: Property name must not be null at org.apache.qpid.jms.message.JmsMessagePropertySupport.checkPropertyNameIsValid(JmsMessagePropertySupport.java:57) ~[qpid-jms-client-0.53.0.jar:na] at org.apache.qpid.jms.message.JmsMessagePropertyIntercepter.getProperty(JmsMessagePropertyIntercepter.java:692) ~[qpid-jms-client-0.53.0.jar:na] at org.apache.qpid.jms.message.JmsMessage.getObjectProperty(JmsMessage.java:353) ~[qpid-jms-client-0.53.0.jar:na] at org.apache.qpid.jms.message.JmsMessage.getStringProperty(JmsMessage.java:393) ~[qpid-jms-client-0.53.0.jar:na] at org.springframework.jms.support.converter.MappingJackson2MessageConverter.getJavaTypeForMessage(MappingJackson2MessageConverter.java:453) ~[spring-jms-5.3.20.jar:5.3.20] at org.springframework.jms.support.converter.MappingJackson2MessageConverter.fromMessage(MappingJackson2MessageConverter.java:233) ~[spring-jms-5.3.20.jar:5.3.20] Let’s take a side-step. When deserialising a JSON string with objectMapper, you explicitly provide the type to deserialise to. For instance:\nString json=\"\"\" { \"firstName\": \"Byram\", \"lastName\": \"Aguirrezabal\" } \"\"\"; //creating a Person object from the json String Person p = objectMapper.readValue(json, Person.class); Now when receiving some text from a message queue, you don’t know what the type is: is it a Person, List, LocalDateTime, … and that is exactly what MappingJackson2MessageConverter.getJavaTypeForMessage is trying to figure out. According to the Javadocs:\n Determine a Jackson JavaType for the given JMS Message, typically parsing a type id message property.\n Solution So you need to add a property to your JMS message stating ‘this message represents a Person, List, ….’, and you need to tell the MappingJackson2MessageConverter what the name of this property is with the setTypeIdPropertyName method - I lik the note in bold, that is hardly mentioned in any other documentation :)\n Specify the name of the JMS message property that carries the type id for the contained object: either a mapped id value or a raw Java class name.\nDefault is none. NOTE: This property needs to be set in order to allow for converting from an incoming message to a Java object.\n Now we are ready to define a custom bean:\n@Bean public MessageConverter jsonJmsConverter() { MappingJackson2MessageConverter jackson = new MappingJackson2MessageConverter(); //json is just text  jackson.setTargetType(MessageType.TEXT); //each message should contain a property called _type and its value is the name of the class to serialize to  jackson.setTypeIdPropertyName(\"_type\"); return jackson; } Allright, let’s test this out. Head over to the Azure portal, select your Service Bus instance and open the Service Bus Explorer (still in preview at the time of writing). In the explorer, you can send messages and put them on the bus.\nThings to note:\n the message body should contain valid JSON set the content type to application/json add a custom property so the converter can find out what class to deserialize to.  Restarting the Spring Boot app, and on the logs I now see this nice message without any stack traces.\n2022-06-15 20:17:30.749 INFO 50892 --- [ntContainer#0-1] com.example.demo.PersonQueueListener : Received Person com.example.demo.Person@7f445293 on Service Bus ","wordCount":"557","inLanguage":"en","datePublished":"2022-06-14T20:17:40Z","dateModified":"2022-08-19T09:07:24+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.pieterjd.be/posts/jms-property-name-must-not-be-null/"},"publisher":{"@type":"Organization","name":"pieterjd.be","logo":{"@type":"ImageObject","url":"https://www.pieterjd.be/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://www.pieterjd.be accesskey=h title="pieterjd.be (Alt + H)">pieterjd.be</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=https://www.pieterjd.be/posts/ title=Posts>
<span>Posts</span>
</a>
</li>
<li>
<a href=https://www.pieterjd.be/talks/ title=Talks>
<span>Talks</span>
</a>
</li>
<li>
<a href=https://www.pieterjd.be/about/ title=About>
<span>About</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Proper JMS conversion to POJOs
</h1>
<div class=post-meta><span title="2022-06-14 20:17:40 +0000 UTC">June 14, 2022</span>&nbsp;·&nbsp;3 min
</div>
</header>
<div class=post-content><p>While looking into Azure Service bus with Spring Boot, I stumbled upon a nasty stacktrace caused by an IllegalArgumentException:</p>
<pre tabindex=0><code>java.lang.IllegalArgumentException: Property name must not be null
</code></pre><p>So what is going on here?</p>
<h2 id=setup>Setup<a hidden class=anchor aria-hidden=true href=#setup>#</a></h2>
<p>I configured a queue <code>persons</code> on Azure service bus and in my spring boot application I defined a QueueListener using the <code>@JmsListener</code> annotation</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=nd>@Component</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>PersonQueueListener</span> <span class=o>{</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>QUEUENAME</span><span class=o>=</span><span class=s>&#34;persons&#34;</span><span class=o>;</span>

    <span class=nd>@JmsListener</span><span class=o>(</span><span class=n>destination</span> <span class=o>=</span> <span class=n>QUEUENAME</span><span class=o>)</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>receiveMessage</span><span class=o>(</span><span class=n>Person</span> <span class=n>person</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>JsonProcessingException</span> <span class=o>{</span>
        <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Received Person {} on Service Bus&#34;</span><span class=o>,</span> <span class=n>person</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></div><p>Somehow I expected this to work - after all the <code>Person</code> class was filled with Jackson annotations. However, exceptions were flying around with the only clue <code>Property name must not be null</code>.</p>
<h2 id=root-cause>Root cause<a hidden class=anchor aria-hidden=true href=#root-cause>#</a></h2>
<pre tabindex=0><code>org.springframework.jms.listener.adapter.ListenerExecutionFailedException: Listener method 'public void com.example.demo.PersonQueueListener.receiveMessage(com.example.demo.Person) throws com.fasterxml.jackson.core.JsonProcessingException' threw exception; nested exception is java.lang.IllegalArgumentException: Property name must not be null
	at org.springframework.jms.listener.adapter.MessagingMessageListenerAdapter.invokeHandler(MessagingMessageListenerAdapter.java:122) ~[spring-jms-5.3.20.jar:5.3.20]
	at org.springframework.jms.listener.adapter.MessagingMessageListenerAdapter.onMessage(MessagingMessageListenerAdapter.java:77) ~[spring-jms-5.3.20.jar:5.3.20]
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:736) ~[spring-jms-5.3.20.jar:5.3.20]
	at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:696) ~[spring-jms-5.3.20.jar:5.3.20]
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:674) ~[spring-jms-5.3.20.jar:5.3.20]
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:331) ~[spring-jms-5.3.20.jar:5.3.20]
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:270) ~[spring-jms-5.3.20.jar:5.3.20]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1237) ~[spring-jms-5.3.20.jar:5.3.20]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1227) ~[spring-jms-5.3.20.jar:5.3.20]
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:1120) ~[spring-jms-5.3.20.jar:5.3.20]
	at java.base/java.lang.Thread.run(Thread.java:833) ~[na:na]
Caused by: java.lang.IllegalArgumentException: Property name must not be null
	at org.apache.qpid.jms.message.JmsMessagePropertySupport.checkPropertyNameIsValid(JmsMessagePropertySupport.java:57) ~[qpid-jms-client-0.53.0.jar:na]
	at org.apache.qpid.jms.message.JmsMessagePropertyIntercepter.getProperty(JmsMessagePropertyIntercepter.java:692) ~[qpid-jms-client-0.53.0.jar:na]
	at org.apache.qpid.jms.message.JmsMessage.getObjectProperty(JmsMessage.java:353) ~[qpid-jms-client-0.53.0.jar:na]
	at org.apache.qpid.jms.message.JmsMessage.getStringProperty(JmsMessage.java:393) ~[qpid-jms-client-0.53.0.jar:na]
	at org.springframework.jms.support.converter.MappingJackson2MessageConverter.getJavaTypeForMessage(MappingJackson2MessageConverter.java:453) ~[spring-jms-5.3.20.jar:5.3.20]
	at org.springframework.jms.support.converter.MappingJackson2MessageConverter.fromMessage(MappingJackson2MessageConverter.java:233) ~[spring-jms-5.3.20.jar:5.3.20]

</code></pre><p>Let&rsquo;s take a side-step. When deserialising a JSON string with objectMapper, you explicitly provide the type to deserialise to. For instance:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=n>String</span> <span class=n>json</span><span class=o>=</span><span class=s>&#34;&#34;&#34;
</span><span class=s>{
</span><span class=s>  &#34;</span><span class=n>firstName</span><span class=s>&#34;: &#34;</span><span class=n>Byram</span><span class=s>&#34;,
</span><span class=s>  &#34;</span><span class=n>lastName</span><span class=s>&#34;: &#34;</span><span class=n>Aguirrezabal</span><span class=s>&#34;
</span><span class=s>}
</span><span class=s>&#34;&#34;&#34;</span><span class=o>;</span>
<span class=c1>//creating a Person object from the json String
</span><span class=c1></span><span class=n>Person</span> <span class=n>p</span> <span class=o>=</span> <span class=n>objectMapper</span><span class=o>.</span><span class=na>readValue</span><span class=o>(</span><span class=n>json</span><span class=o>,</span> <span class=n>Person</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</code></pre></div><p>Now when receiving some text from a message queue, you don&rsquo;t know what the type is: is it a <code>Person</code>, <code>List</code>, <code>LocalDateTime</code>, &mldr; and that is exactly what <code>MappingJackson2MessageConverter.getJavaTypeForMessage</code> is trying to figure out. According to the <a href=https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/jms/support/converter/MappingJackson2MessageConverter.html#getJavaTypeForMessage-javax.jms.Message->Javadocs</a>:</p>
<blockquote>
<p>Determine a Jackson JavaType for the given JMS Message, typically parsing a type id message property.</p>
</blockquote>
<h2 id=solution>Solution<a hidden class=anchor aria-hidden=true href=#solution>#</a></h2>
<p>So you need to add a property to your JMS message stating &lsquo;this message represents a Person, List, &mldr;.&rsquo;, and you need to tell the <code>MappingJackson2MessageConverter</code> what the name of this property is with the <a href=https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/jms/support/converter/MappingJackson2MessageConverter.html#setTypeIdPropertyName-java.lang.String-><code>setTypeIdPropertyName</code> method</a> - I lik the note in bold, that is hardly mentioned in any other documentation :)</p>
<blockquote>
<p>Specify the name of the JMS message property that carries the type id for the contained object: either a mapped id value or a raw Java class name.</p>
<p>Default is none. <strong>NOTE: This property needs to be set in order to allow for converting from an incoming message to a Java object.</strong></p>
</blockquote>
<p>Now we are ready to define a custom bean:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java> <span class=nd>@Bean</span>
<span class=kd>public</span> <span class=n>MessageConverter</span> <span class=nf>jsonJmsConverter</span><span class=o>()</span> <span class=o>{</span>
  <span class=n>MappingJackson2MessageConverter</span> <span class=n>jackson</span> <span class=o>=</span> <span class=k>new</span> <span class=n>MappingJackson2MessageConverter</span><span class=o>();</span>
  <span class=c1>//json is just text
</span><span class=c1></span>  <span class=n>jackson</span><span class=o>.</span><span class=na>setTargetType</span><span class=o>(</span><span class=n>MessageType</span><span class=o>.</span><span class=na>TEXT</span><span class=o>);</span>
  <span class=c1>//each message should contain a property called _type and its value is the name of the class to serialize to
</span><span class=c1></span>  <span class=n>jackson</span><span class=o>.</span><span class=na>setTypeIdPropertyName</span><span class=o>(</span><span class=s>&#34;_type&#34;</span><span class=o>);</span>
  <span class=k>return</span> <span class=n>jackson</span><span class=o>;</span>
<span class=o>}</span>
</code></pre></div><p>Allright, let&rsquo;s test this out. Head over to the Azure portal, select your Service Bus instance and open the Service Bus Explorer (still in preview at the time of writing). In the explorer, you can send messages and put them on the bus.</p>
<p><img loading=lazy src=./service-bus-explorer.png alt="Service Bus Explorer">
Things to note:</p>
<ol>
<li>the message body should contain valid JSON</li>
<li>set the content type to <code>application/json</code></li>
<li>add a custom property so the converter can find out what class to deserialize to.</li>
</ol>
<p>Restarting the Spring Boot app, and on the logs I now see this nice message without any stack traces.</p>
<pre tabindex=0><code>2022-06-15 20:17:30.749  INFO 50892 --- [ntContainer#0-1] com.example.demo.PersonQueueListener     : Received Person com.example.demo.Person@7f445293 on Service Bus
</code></pre>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://www.pieterjd.be/tags/spring-boot/>Spring Boot</a></li>
<li><a href=https://www.pieterjd.be/tags/jms/>JMS</a></li>
<li><a href=https://www.pieterjd.be/tags/messageconverter/>MessageConverter</a></li>
<li><a href=https://www.pieterjd.be/tags/azure-service-bus/>Azure Service Bus</a></li>
</ul>
<nav class=paginav>
<a class=next href=https://www.pieterjd.be/posts/reduce-docker-ps-clutter-with-awk/>
<span class=title>Next »</span>
<br>
<span>Reduce docker ps Output Clutter with AWK</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://www.pieterjd.be>Pieter-Jan Drouillon</a></span>
<span> . </span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerHTML='copy';function d(){a.innerHTML='copied!',setTimeout(()=>{a.innerHTML='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>