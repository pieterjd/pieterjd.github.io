<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Minified Javascript in AEM Clientlibs breaks the build | pieterjd.be</title>
<meta name=keywords content="AEM,Client Library,Minification,Broken build">
<meta name=description content="Recently we had to integrate third-party minified javascript and css in an AEM client library. Unfortunatly this broke the build on Adobe Cloud. How did we solve this?
What&rsquo;s the problem? Minification! From our client, we received already minified javascript and styling we needed to integrate in the AEM website. Nothing too difficult, but the build on AEM Cloud finished with errors. On top of that, we could not download the logs, so we really were in the dark here.">
<meta name=author content>
<link rel=canonical href=https://www.pieterjd.be/posts/minified-javascript-in-aem-clientlib/>
<meta name=google-site-verification content="MN3Sf5TrdFo5j8qHAiXG2_gF0P1tXmClJN0JX8TvqgU">
<link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.pieterjd.be/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://www.pieterjd.be/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://www.pieterjd.be/favicon-32x32.png>
<link rel=apple-touch-icon href=https://www.pieterjd.be/apple-touch-icon.png>
<link rel=mask-icon href=https://www.pieterjd.be/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-132459675-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="Minified Javascript in AEM Clientlibs breaks the build">
<meta property="og:description" content="Recently we had to integrate third-party minified javascript and css in an AEM client library. Unfortunatly this broke the build on Adobe Cloud. How did we solve this?
What&rsquo;s the problem? Minification! From our client, we received already minified javascript and styling we needed to integrate in the AEM website. Nothing too difficult, but the build on AEM Cloud finished with errors. On top of that, we could not download the logs, so we really were in the dark here.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.pieterjd.be/posts/minified-javascript-in-aem-clientlib/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-01-30T21:25:00+02:00">
<meta property="article:modified_time" content="2022-07-30T21:46:07+02:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Minified Javascript in AEM Clientlibs breaks the build">
<meta name=twitter:description content="Recently we had to integrate third-party minified javascript and css in an AEM client library. Unfortunatly this broke the build on Adobe Cloud. How did we solve this?
What&rsquo;s the problem? Minification! From our client, we received already minified javascript and styling we needed to integrate in the AEM website. Nothing too difficult, but the build on AEM Cloud finished with errors. On top of that, we could not download the logs, so we really were in the dark here.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://www.pieterjd.be/posts/"},{"@type":"ListItem","position":3,"name":"Minified Javascript in AEM Clientlibs breaks the build","item":"https://www.pieterjd.be/posts/minified-javascript-in-aem-clientlib/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Minified Javascript in AEM Clientlibs breaks the build","name":"Minified Javascript in AEM Clientlibs breaks the build","description":"Recently we had to integrate third-party minified javascript and css in an AEM client library. Unfortunatly this broke the build on Adobe Cloud. How did we solve this?\nWhat\u0026rsquo;s the problem? Minification! From our client, we received already minified javascript and styling we needed to integrate in the AEM website. Nothing too difficult, but the build on AEM Cloud finished with errors. On top of that, we could not download the logs, so we really were in the dark here.","keywords":["AEM","Client Library","Minification","Broken build"],"articleBody":"Recently we had to integrate third-party minified javascript and css in an AEM client library. Unfortunatly this broke the build on Adobe Cloud. How did we solve this?\nWhatâ€™s the problem? Minification! From our client, we received already minified javascript and styling we needed to integrate in the AEM website. Nothing too difficult, but the build on AEM Cloud finished with errors. On top of that, we could not download the logs, so we really were in the dark here.\nAfter a lot of trial and error, we were able to find the commit causing the issue (we had pushed a lot of new features). It was the commit containing the minified javascript.\nBy default, AEM minifies all the client libraries. Usually, the client libraries consists of non-optimized javascript (ie. no minification nor linting) - so no issue there.\nHowever, minification of already minified client libraries is not that straightforward and is apparently a build breaker ðŸ˜².\nWhatâ€™s the solution? Clientlib Preprocessor! After a day or two, I remembered I worked on Client library preprocessing at a previous project. For each client library you can define what preprocessor to use for minification. One of the valid values is none, so no minification. After configuring the clientlib to not minify it, the build was again successful.\nConclusion If you need to integrate minified javascript in your AEM client library, turn off the minification using the preprocessor configuration\n","wordCount":"236","inLanguage":"en","datePublished":"2021-01-30T21:25:00+02:00","dateModified":"2022-07-30T21:46:07+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.pieterjd.be/posts/minified-javascript-in-aem-clientlib/"},"publisher":{"@type":"Organization","name":"pieterjd.be","logo":{"@type":"ImageObject","url":"https://www.pieterjd.be/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://www.pieterjd.be accesskey=h title="pieterjd.be (Alt + H)">pieterjd.be</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=https://www.pieterjd.be/posts/ title=Posts>
<span>Posts</span>
</a>
</li>
<li>
<a href=https://www.pieterjd.be/talks/ title=Talks>
<span>Talks</span>
</a>
</li>
<li>
<a href=https://www.pieterjd.be/about/ title=About>
<span>About</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Minified Javascript in AEM Clientlibs breaks the build
</h1>
<div class=post-meta><span title="2021-01-30 21:25:00 +0200 +0200">January 30, 2021</span>
</div>
</header>
<div class=post-content><p>Recently we had to integrate third-party minified javascript and css in an AEM client library. Unfortunatly this broke the build on Adobe Cloud. How did we solve this?</p>
<h2 id=whats-the-problem-minification>What&rsquo;s the problem? Minification!<a hidden class=anchor aria-hidden=true href=#whats-the-problem-minification>#</a></h2>
<p>From our client, we received already minified javascript and styling we needed to integrate in the AEM website. Nothing too difficult, but the build on AEM Cloud finished with errors. On top of that, we could not download the logs, so we really were in the dark here.</p>
<p>After a lot of trial and error, we were able to find the commit causing the issue (we had pushed a lot of new features). It was the commit containing the minified javascript.</p>
<p>By default, AEM minifies all the client libraries. Usually, the client libraries consists of non-optimized javascript (ie. no minification nor linting) - so no issue there.</p>
<p>However, minification of already minified client libraries is not that straightforward and is apparently a build breaker ðŸ˜².</p>
<h2 id=whats-the-solution-clientlib-preprocessor>What&rsquo;s the solution? Clientlib Preprocessor!<a hidden class=anchor aria-hidden=true href=#whats-the-solution-clientlib-preprocessor>#</a></h2>
<p>After a day or two, I remembered I worked on Client library <a href="https://experienceleague.adobe.com/docs/experience-manager-64/developing/introduction/clientlibs.html?lang=en#using-preprocessors">preprocessing</a> at a previous project. For each client library you can define what preprocessor to use for minification. One of the valid values is <code>none</code>, so no minification. After configuring the clientlib to not minify it, the build was again successful.</p>
<h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2>
<p>If you need to integrate minified javascript in your AEM client library, turn off the minification using the preprocessor configuration</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://www.pieterjd.be/tags/aem/>AEM</a></li>
<li><a href=https://www.pieterjd.be/tags/client-library/>Client Library</a></li>
<li><a href=https://www.pieterjd.be/tags/minification/>Minification</a></li>
<li><a href=https://www.pieterjd.be/tags/broken-build/>Broken build</a></li>
</ul>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://www.pieterjd.be>Pieter-Jan Drouillon</a></span>
<span> . </span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>