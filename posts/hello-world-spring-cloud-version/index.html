<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#494f5c"><meta name=msapplication-TileColor content="#494f5c"><meta itemprop=name content="Hello World - Spring Cloud Version"><meta itemprop=description content="I&rsquo;ve wanting to look into some microservices, but I never got around to it. I stumbled upon Java Brain&rsquo;s Spring boot microservice course, which is a great series of videos explaining all the concepts.
My hello world - Spring Cloud Version contains 3 microservices:
 datetime-service: returns the current datetime salutation-service: returns at random a salutation for male or female persons greeting-service: uses the first 2 services to compose a greeting  Here&rsquo;s a diagram how they all interact with each other: Keypoints Here are some things that stuck into my head after watching the course:"><meta itemprop=datePublished content="2020-10-17T09:12:00+02:00"><meta itemprop=dateModified content="2020-10-17T09:12:00+02:00"><meta itemprop=wordCount content="538"><meta itemprop=keywords content><meta property="og:title" content="Hello World - Spring Cloud Version"><meta property="og:description" content="I&rsquo;ve wanting to look into some microservices, but I never got around to it. I stumbled upon Java Brain&rsquo;s Spring boot microservice course, which is a great series of videos explaining all the concepts.
My hello world - Spring Cloud Version contains 3 microservices:
 datetime-service: returns the current datetime salutation-service: returns at random a salutation for male or female persons greeting-service: uses the first 2 services to compose a greeting  Here&rsquo;s a diagram how they all interact with each other: Keypoints Here are some things that stuck into my head after watching the course:"><meta property="og:type" content="article"><meta property="og:url" content="http://www.pieterjd.be/posts/hello-world-spring-cloud-version/"><meta property="article:published_time" content="2020-10-17T09:12:00+02:00"><meta property="article:modified_time" content="2020-10-17T09:12:00+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Hello World - Spring Cloud Version"><meta name=twitter:description content="I&rsquo;ve wanting to look into some microservices, but I never got around to it. I stumbled upon Java Brain&rsquo;s Spring boot microservice course, which is a great series of videos explaining all the concepts.
My hello world - Spring Cloud Version contains 3 microservices:
 datetime-service: returns the current datetime salutation-service: returns at random a salutation for male or female persons greeting-service: uses the first 2 services to compose a greeting  Here&rsquo;s a diagram how they all interact with each other: Keypoints Here are some things that stuck into my head after watching the course:"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>Hello World - Spring Cloud Version</title><link rel=stylesheet href=http://www.pieterjd.be/css/style.min.657bcb7af31123e4156b1a3d2ff60a636717e54ead74f882136b5114cf72b55e.css integrity="sha256-ZXvLevMRI+QVaxo9L/YKY2cX5U6tdPiCE2tRFM9ytV4=" crossorigin=anonymous><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-132459675-1','auto');ga('send','pageview');}</script></head><body id=page><header id=site-header class="animated slideInUp faster"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=http://www.pieterjd.be>pieterjd.be</a></div><nav class="site-nav hide-in-mobile"><a href=http://www.pieterjd.be/posts/>Posts</a>
<a href=http://www.pieterjd.be/talks/>Talks</a>
<a href=http://www.pieterjd.be/about/>About</a></nav></div><div class="hdr-right hdr-icons"><span class="hdr-social hide-in-mobile"><a href=https://www.linkedin.com/in/pieterjandrouillon/ target=_blank rel="noopener me" title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a href=https://github.com/pieterjd target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=http://www.pieterjd.be/posts/>Posts</a></li><li><a href=http://www.pieterjd.be/talks/>Talks</a></li><li><a href=http://www.pieterjd.be/about/>About</a></li></ul></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>Oct 17, 2020</span></div><h1>Hello World - Spring Cloud Version</h1></header><div class=content><p>I&rsquo;ve wanting to look into some microservices, but I never got around to it. I stumbled upon <a href="https://www.youtube.com/c/JavaBrainsChannel/playlists?view=50&sort=dd&shelf_id=12">Java Brain&rsquo;s Spring boot microservice course</a>, which is a great series of videos explaining all the concepts.</p><p>My hello world - Spring Cloud Version contains 3 microservices:</p><ul><li><code>datetime-service</code>: returns the current datetime</li><li><code>salutation-service</code>: returns at random a salutation for male or female persons</li><li><code>greeting-service</code>: uses the first 2 services to compose a greeting</li></ul><p>Here&rsquo;s a diagram how they all interact with each other:
<img src=./springcloud-helloworld.png alt></p><h2 id=keypoints>Keypoints<a href=#keypoints class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>Here are some things that stuck into my head after watching the course:</p><ul><li><p>It&rsquo;s ok to duplicate <code>data</code>classes. Each microservice should be standalone. As a consequence, there is some code duplication in the model package.</p><p>A common dependency on the datamodel breaks the standalone principle.</p></li><li><p>Each REST endpoint returns an object. This makes it easy to change the return values.</p><p>Suppose an endpoint returns a String. After some time, you need to return a List as well. Now the response of the endpoint breaks the consuming clients. If an object is returned, you can add a field without breaking anything, because spring only unserializes the field it&rsquo;s aware of.</p></li><li><p>Configure the server port explicitly. This avoids port collision ðŸ˜ƒ. Don&rsquo;t use <code>0</code>. When running, a random port will be assigned but the instances will not show up in the discovery service (each instance has a name where the configured port value is used as unique identifier. If you spin up all your instance with port 0, there is nothing unique).</p></li><li><p>From the level 2 series: keep in mind hystrix wraps the class containing the <code>@HystrixCommand</code> annotation in a <strong>PROXY CLASS</strong> - I&rsquo;ve put it in bold as this is very important.</p><ul><li>if the fallbackMethod is a method in the same class it will not work, <a href="https://youtu.be/1EIb-4ipWFk?list=PLqq-6Pq4lTTbXZY_elyGv7IkKrfkSrX5e&t=517">because of the proxy class</a>!</li><li>My solution:<ol><li>The service class containing the method that can go awry, also contains the fallback method. No <code>@HystrixCommand</code> involved here</li><li>The <code>RestController</code> class has the service autowired. To be precise: the service wrapped in <strong>the proxy class</strong>. The endpoint calling the awry service method <strong>is</strong> annotated with the<code>@HystrixCommand</code> annotation</li><li>The fallbackMethod defined in the <code>RestController</code> class just delegates to the fallback method of the autowired service. This is not an issue, as the fallback method is also wrapped in the proxy class</li></ol></li></ul></li></ul><h2 id=spinning-up-multiple-instances>Spinning up multiple instances<a href=#spinning-up-multiple-instances class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>Kick of the jar and set the <code>spring.port</code> property with the <code>java</code> command. However it&rsquo;s quite tedious if you want 4 instances of each of the three microservices. Below an powershell snippet on how to kick things off quickly. It generates the commands that you then can paste in the bash terminal</p><div class=highlight><pre class=chroma><code class=language-powershell data-lang=powershell><span class=nv>$template</span> <span class=p>=</span> <span class=s1>&#39;java -Dserver.port={0} -jar {1} &amp;&#39;</span>
<span class=nv>$startPort</span><span class=p>=</span><span class=n>50000</span>
<span class=nv>$increment</span> <span class=p>=</span> <span class=n>100</span>
<span class=c>#get jars except eureka-server</span>
<span class=nb>gci </span><span class=n>-Recurse</span> <span class=p>*.</span><span class=n>jar</span> <span class=p>|?{</span><span class=nv>$_</span><span class=p>.</span><span class=n>name</span> <span class=o>-notlike</span> <span class=s1>&#39;*eureka*&#39;</span><span class=p>}</span> <span class=p>|%{</span>
 <span class=nv>$jarName</span> <span class=p>=</span> <span class=nv>$_</span>
 <span class=n>0</span><span class=p>..</span><span class=n>3</span> <span class=p>|</span> <span class=p>%{</span><span class=nv>$port</span> <span class=p>=</span> <span class=nv>$startPort</span> <span class=p>+</span><span class=nv>$_</span><span class=p>;</span> <span class=nv>$template</span> <span class=o>-f</span> <span class=nv>$port</span><span class=p>,</span><span class=nv>$jarName</span><span class=p>}</span>
 <span class=nv>$startPort</span><span class=p>+=</span><span class=nv>$increment</span>
<span class=p>}</span>
</code></pre></div><p>Sample output:</p><pre><code>java -Dserver.port=50000 -jar /Users/pjd/_dev/springcloud-helloworld/datetime-service/target/datetime-service-0.0.1-SNAPSHOT.jar &amp;
java -Dserver.port=50001 -jar /Users/pjd/_dev/springcloud-helloworld/datetime-service/target/datetime-service-0.0.1-SNAPSHOT.jar &amp;
java -Dserver.port=50002 -jar /Users/pjd/_dev/springcloud-helloworld/datetime-service/target/datetime-service-0.0.1-SNAPSHOT.jar &amp;
java -Dserver.port=50003 -jar /Users/pjd/_dev/springcloud-helloworld/datetime-service/target/datetime-service-0.0.1-SNAPSHOT.jar &amp;

java -Dserver.port=50100 -jar /Users/pjd/_dev/springcloud-helloworld/greeting-service/target/greeting-service-0.0.1-SNAPSHOT.jar &amp;
java -Dserver.port=50101 -jar /Users/pjd/_dev/springcloud-helloworld/greeting-service/target/greeting-service-0.0.1-SNAPSHOT.jar &amp;
java -Dserver.port=50102 -jar /Users/pjd/_dev/springcloud-helloworld/greeting-service/target/greeting-service-0.0.1-SNAPSHOT.jar &amp;
java -Dserver.port=50103 -jar /Users/pjd/_dev/springcloud-helloworld/greeting-service/target/greeting-service-0.0.1-SNAPSHOT.jar &amp;

java -Dserver.port=50200 -jar /Users/pjd/_dev/springcloud-helloworld/salutation-service/target/salutation-service-0.0.1-SNAPSHOT.jar &amp;
java -Dserver.port=50201 -jar /Users/pjd/_dev/springcloud-helloworld/salutation-service/target/salutation-service-0.0.1-SNAPSHOT.jar &amp;
java -Dserver.port=50202 -jar /Users/pjd/_dev/springcloud-helloworld/salutation-service/target/salutation-service-0.0.1-SNAPSHOT.jar &amp;
java -Dserver.port=50203 -jar /Users/pjd/_dev/springcloud-helloworld/salutation-service/target/salutation-service-0.0.1-SNAPSHOT.jar &amp;
</code></pre></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>538 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2020-10-17 07:12 +0000</p></footer></article><div class="post-nav thin"><a class=next-post href=http://www.pieterjd.be/posts/adventures-with-azure/><span class=post-nav-label><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>&nbsp;Newer</span><br><span>Adventures with Microsoft Azure</span></a>
<a class=prev-post href=http://www.pieterjd.be/posts/mac-free-tools/><span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>Tools for Mac OS I use for easier development</span></a></div><div id=comments class=thin></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2020 <a href=http://www.pieterjd.be>Pieter-Jan Drouillon</a> &#183; <a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=http://www.pieterjd.be/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=http://www.pieterjd.be/js/bundle.min.4a9a0ac3d2217822c7865b4161e6c2a71de1d70492264337755427898dd718f6.js integrity="sha256-SpoKw9IheCLHhltBYebCpx3h1wSSJkM3dVQniY3XGPY=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-132459675-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>