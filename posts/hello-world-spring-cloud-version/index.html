<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Hello World - Spring Cloud Version | pieterjd.be</title>
<meta name=keywords content>
<meta name=description content="I&rsquo;ve wanting to look into some microservices, but I never got around to it. I stumbled upon Java Brain&rsquo;s Spring boot microservice course, which is a great series of videos explaining all the concepts.
My hello world - Spring Cloud Version contains 3 microservices:
 datetime-service: returns the current datetime salutation-service: returns at random a salutation for male or female persons greeting-service: uses the first 2 services to compose a greeting  Here&rsquo;s a diagram how they all interact with each other: Keypoints Here are some things that stuck into my head after watching the course:">
<meta name=author content>
<link rel=canonical href=https://www.pieterjd.be/posts/hello-world-spring-cloud-version/>
<meta name=google-site-verification content="MN3Sf5TrdFo5j8qHAiXG2_gF0P1tXmClJN0JX8TvqgU">
<link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.pieterjd.be/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://www.pieterjd.be/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://www.pieterjd.be/favicon-32x32.png>
<link rel=apple-touch-icon href=https://www.pieterjd.be/apple-touch-icon.png>
<link rel=mask-icon href=https://www.pieterjd.be/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-132459675-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="Hello World - Spring Cloud Version">
<meta property="og:description" content="I&rsquo;ve wanting to look into some microservices, but I never got around to it. I stumbled upon Java Brain&rsquo;s Spring boot microservice course, which is a great series of videos explaining all the concepts.
My hello world - Spring Cloud Version contains 3 microservices:
 datetime-service: returns the current datetime salutation-service: returns at random a salutation for male or female persons greeting-service: uses the first 2 services to compose a greeting  Here&rsquo;s a diagram how they all interact with each other: Keypoints Here are some things that stuck into my head after watching the course:">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.pieterjd.be/posts/hello-world-spring-cloud-version/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2020-10-17T09:12:00+02:00">
<meta property="article:modified_time" content="2022-08-01T17:11:51+02:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Hello World - Spring Cloud Version">
<meta name=twitter:description content="I&rsquo;ve wanting to look into some microservices, but I never got around to it. I stumbled upon Java Brain&rsquo;s Spring boot microservice course, which is a great series of videos explaining all the concepts.
My hello world - Spring Cloud Version contains 3 microservices:
 datetime-service: returns the current datetime salutation-service: returns at random a salutation for male or female persons greeting-service: uses the first 2 services to compose a greeting  Here&rsquo;s a diagram how they all interact with each other: Keypoints Here are some things that stuck into my head after watching the course:">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://www.pieterjd.be/posts/"},{"@type":"ListItem","position":3,"name":"Hello World - Spring Cloud Version","item":"https://www.pieterjd.be/posts/hello-world-spring-cloud-version/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Hello World - Spring Cloud Version","name":"Hello World - Spring Cloud Version","description":"I\u0026rsquo;ve wanting to look into some microservices, but I never got around to it. I stumbled upon Java Brain\u0026rsquo;s Spring boot microservice course, which is a great series of videos explaining all the concepts.\nMy hello world - Spring Cloud Version contains 3 microservices:\n datetime-service: returns the current datetime salutation-service: returns at random a salutation for male or female persons greeting-service: uses the first 2 services to compose a greeting  Here\u0026rsquo;s a diagram how they all interact with each other: Keypoints Here are some things that stuck into my head after watching the course:","keywords":[],"articleBody":"Iâ€™ve wanting to look into some microservices, but I never got around to it. I stumbled upon Java Brainâ€™s Spring boot microservice course, which is a great series of videos explaining all the concepts.\nMy hello world - Spring Cloud Version contains 3 microservices:\n datetime-service: returns the current datetime salutation-service: returns at random a salutation for male or female persons greeting-service: uses the first 2 services to compose a greeting  Hereâ€™s a diagram how they all interact with each other: Keypoints Here are some things that stuck into my head after watching the course:\n  Itâ€™s ok to duplicate dataclasses. Each microservice should be standalone. As a consequence, there is some code duplication in the model package.\nA common dependency on the datamodel breaks the standalone principle.\n  Each REST endpoint returns an object. This makes it easy to change the return values.\nSuppose an endpoint returns a String. After some time, you need to return a List as well. Now the response of the endpoint breaks the consuming clients. If an object is returned, you can add a field without breaking anything, because spring only unserializes the field itâ€™s aware of.\n  Configure the server port explicitly. This avoids port collision ðŸ˜ƒ. Donâ€™t use 0. When running, a random port will be assigned but the instances will not show up in the discovery service (each instance has a name where the configured port value is used as unique identifier. If you spin up all your instance with port 0, there is nothing unique).\n  From the level 2 series: keep in mind hystrix wraps the class containing the @HystrixCommand annotation in a PROXY CLASS - Iâ€™ve put it in bold as this is very important.\n if the fallbackMethod is a method in the same class it will not work, because of the proxy class! My solution:  The service class containing the method that can go awry, also contains the fallback method. No @HystrixCommand involved here The RestController class has the service autowired. To be precise: the service wrapped in the proxy class. The endpoint calling the awry service method is annotated with the@HystrixCommand annotation The fallbackMethod defined in the RestController class just delegates to the fallback method of the autowired service. This is not an issue, as the fallback method is also wrapped in the proxy class      Spinning up multiple instances Kick of the jar and set the spring.port property with the java command. However itâ€™s quite tedious if you want 4 instances of each of the three microservices. Below an powershell snippet on how to kick things off quickly. It generates the commands that you then can paste in the bash terminal\n$template = 'java -Dserver.port={0} -jar {1} \u0026' $startPort=50000 $increment = 100 #get jars except eureka-server gci -Recurse *.jar |?{$_.name -notlike '*eureka*'} |%{ $jarName = $_ 0..3 | %{$port = $startPort +$_; $template -f $port,$jarName} $startPort+=$increment } Sample output:\njava -Dserver.port=50000 -jar /Users/pjd/_dev/springcloud-helloworld/datetime-service/target/datetime-service-0.0.1-SNAPSHOT.jar \u0026 java -Dserver.port=50001 -jar /Users/pjd/_dev/springcloud-helloworld/datetime-service/target/datetime-service-0.0.1-SNAPSHOT.jar \u0026 java -Dserver.port=50002 -jar /Users/pjd/_dev/springcloud-helloworld/datetime-service/target/datetime-service-0.0.1-SNAPSHOT.jar \u0026 java -Dserver.port=50003 -jar /Users/pjd/_dev/springcloud-helloworld/datetime-service/target/datetime-service-0.0.1-SNAPSHOT.jar \u0026 java -Dserver.port=50100 -jar /Users/pjd/_dev/springcloud-helloworld/greeting-service/target/greeting-service-0.0.1-SNAPSHOT.jar \u0026 java -Dserver.port=50101 -jar /Users/pjd/_dev/springcloud-helloworld/greeting-service/target/greeting-service-0.0.1-SNAPSHOT.jar \u0026 java -Dserver.port=50102 -jar /Users/pjd/_dev/springcloud-helloworld/greeting-service/target/greeting-service-0.0.1-SNAPSHOT.jar \u0026 java -Dserver.port=50103 -jar /Users/pjd/_dev/springcloud-helloworld/greeting-service/target/greeting-service-0.0.1-SNAPSHOT.jar \u0026 java -Dserver.port=50200 -jar /Users/pjd/_dev/springcloud-helloworld/salutation-service/target/salutation-service-0.0.1-SNAPSHOT.jar \u0026 java -Dserver.port=50201 -jar /Users/pjd/_dev/springcloud-helloworld/salutation-service/target/salutation-service-0.0.1-SNAPSHOT.jar \u0026 java -Dserver.port=50202 -jar /Users/pjd/_dev/springcloud-helloworld/salutation-service/target/salutation-service-0.0.1-SNAPSHOT.jar \u0026 java -Dserver.port=50203 -jar /Users/pjd/_dev/springcloud-helloworld/salutation-service/target/salutation-service-0.0.1-SNAPSHOT.jar \u0026 ","wordCount":"538","inLanguage":"en","datePublished":"2020-10-17T09:12:00+02:00","dateModified":"2022-08-01T17:11:51+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.pieterjd.be/posts/hello-world-spring-cloud-version/"},"publisher":{"@type":"Organization","name":"pieterjd.be","logo":{"@type":"ImageObject","url":"https://www.pieterjd.be/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://www.pieterjd.be accesskey=h title="pieterjd.be (Alt + H)">pieterjd.be</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=https://www.pieterjd.be/posts/ title=Posts>
<span>Posts</span>
</a>
</li>
<li>
<a href=https://www.pieterjd.be/talks/ title=Talks>
<span>Talks</span>
</a>
</li>
<li>
<a href=https://www.pieterjd.be/about/ title=About>
<span>About</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Hello World - Spring Cloud Version
</h1>
<div class=post-meta><span title="2020-10-17 09:12:00 +0200 +0200">October 17, 2020</span>&nbsp;Â·&nbsp;3 min
</div>
</header>
<div class=post-content><p>I&rsquo;ve wanting to look into some microservices, but I never got around to it. I stumbled upon <a href="https://www.youtube.com/c/JavaBrainsChannel/playlists?view=50&sort=dd&shelf_id=12">Java Brain&rsquo;s Spring boot microservice course</a>, which is a great series of videos explaining all the concepts.</p>
<p>My hello world - Spring Cloud Version contains 3 microservices:</p>
<ul>
<li><code>datetime-service</code>: returns the current datetime</li>
<li><code>salutation-service</code>: returns at random a salutation for male or female persons</li>
<li><code>greeting-service</code>: uses the first 2 services to compose a greeting</li>
</ul>
<p>Here&rsquo;s a diagram how they all interact with each other:
<img loading=lazy src=./springcloud-helloworld.png alt>
</p>
<h2 id=keypoints>Keypoints<a hidden class=anchor aria-hidden=true href=#keypoints>#</a></h2>
<p>Here are some things that stuck into my head after watching the course:</p>
<ul>
<li>
<p>It&rsquo;s ok to duplicate <code>data</code>classes. Each microservice should be standalone. As a consequence, there is some code duplication in the model package.</p>
<p>A common dependency on the datamodel breaks the standalone principle.</p>
</li>
<li>
<p>Each REST endpoint returns an object. This makes it easy to change the return values.</p>
<p>Suppose an endpoint returns a String. After some time, you need to return a List as well. Now the response of the endpoint breaks the consuming clients. If an object is returned, you can add a field without breaking anything, because spring only unserializes the field it&rsquo;s aware of.</p>
</li>
<li>
<p>Configure the server port explicitly. This avoids port collision ðŸ˜ƒ. Don&rsquo;t use <code>0</code>. When running, a random port will be assigned but the instances will not show up in the discovery service (each instance has a name where the configured port value is used as unique identifier. If you spin up all your instance with port 0, there is nothing unique).</p>
</li>
<li>
<p>From the level 2 series: keep in mind hystrix wraps the class containing the <code>@HystrixCommand</code> annotation in a <strong>PROXY CLASS</strong> - I&rsquo;ve put it in bold as this is very important.</p>
<ul>
<li>if the fallbackMethod is a method in the same class it will not work, <a href="https://youtu.be/1EIb-4ipWFk?list=PLqq-6Pq4lTTbXZY_elyGv7IkKrfkSrX5e&t=517">because of the proxy class</a>!</li>
<li>My solution:
<ol>
<li>The service class containing the method that can go awry, also contains the fallback method. No <code>@HystrixCommand</code> involved here</li>
<li>The <code>RestController</code> class has the service autowired. To be precise: the service wrapped in <strong>the proxy class</strong>. The endpoint calling the awry service method <strong>is</strong> annotated with the<code>@HystrixCommand</code> annotation</li>
<li>The fallbackMethod defined in the <code>RestController</code> class just delegates to the fallback method of the autowired service. This is not an issue, as the fallback method is also wrapped in the proxy class</li>
</ol>
</li>
</ul>
</li>
</ul>
<h2 id=spinning-up-multiple-instances>Spinning up multiple instances<a hidden class=anchor aria-hidden=true href=#spinning-up-multiple-instances>#</a></h2>
<p>Kick of the jar and set the <code>spring.port</code> property with the <code>java</code> command. However it&rsquo;s quite tedious if you want 4 instances of each of the three microservices. Below an powershell snippet on how to kick things off quickly. It generates the commands that you then can paste in the bash terminal</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=nv>$template</span> <span class=p>=</span> <span class=s1>&#39;java -Dserver.port={0} -jar {1} &amp;&#39;</span>
<span class=nv>$startPort</span><span class=p>=</span><span class=n>50000</span>
<span class=nv>$increment</span> <span class=p>=</span> <span class=n>100</span>
<span class=c>#get jars except eureka-server</span>
<span class=nb>gci </span><span class=n>-Recurse</span> <span class=p>*.</span><span class=n>jar</span> <span class=p>|?{</span><span class=nv>$_</span><span class=p>.</span><span class=n>name</span> <span class=o>-notlike</span> <span class=s1>&#39;*eureka*&#39;</span><span class=p>}</span> <span class=p>|%{</span>
 <span class=nv>$jarName</span> <span class=p>=</span> <span class=nv>$_</span>
 <span class=n>0</span><span class=p>..</span><span class=n>3</span> <span class=p>|</span> <span class=p>%{</span><span class=nv>$port</span> <span class=p>=</span> <span class=nv>$startPort</span> <span class=p>+</span><span class=nv>$_</span><span class=p>;</span> <span class=nv>$template</span> <span class=o>-f</span> <span class=nv>$port</span><span class=p>,</span><span class=nv>$jarName</span><span class=p>}</span>
 <span class=nv>$startPort</span><span class=p>+=</span><span class=nv>$increment</span>
<span class=p>}</span>
</code></pre></div><p>Sample output:</p>
<pre tabindex=0><code>java -Dserver.port=50000 -jar /Users/pjd/_dev/springcloud-helloworld/datetime-service/target/datetime-service-0.0.1-SNAPSHOT.jar &amp;
java -Dserver.port=50001 -jar /Users/pjd/_dev/springcloud-helloworld/datetime-service/target/datetime-service-0.0.1-SNAPSHOT.jar &amp;
java -Dserver.port=50002 -jar /Users/pjd/_dev/springcloud-helloworld/datetime-service/target/datetime-service-0.0.1-SNAPSHOT.jar &amp;
java -Dserver.port=50003 -jar /Users/pjd/_dev/springcloud-helloworld/datetime-service/target/datetime-service-0.0.1-SNAPSHOT.jar &amp;

java -Dserver.port=50100 -jar /Users/pjd/_dev/springcloud-helloworld/greeting-service/target/greeting-service-0.0.1-SNAPSHOT.jar &amp;
java -Dserver.port=50101 -jar /Users/pjd/_dev/springcloud-helloworld/greeting-service/target/greeting-service-0.0.1-SNAPSHOT.jar &amp;
java -Dserver.port=50102 -jar /Users/pjd/_dev/springcloud-helloworld/greeting-service/target/greeting-service-0.0.1-SNAPSHOT.jar &amp;
java -Dserver.port=50103 -jar /Users/pjd/_dev/springcloud-helloworld/greeting-service/target/greeting-service-0.0.1-SNAPSHOT.jar &amp;

java -Dserver.port=50200 -jar /Users/pjd/_dev/springcloud-helloworld/salutation-service/target/salutation-service-0.0.1-SNAPSHOT.jar &amp;
java -Dserver.port=50201 -jar /Users/pjd/_dev/springcloud-helloworld/salutation-service/target/salutation-service-0.0.1-SNAPSHOT.jar &amp;
java -Dserver.port=50202 -jar /Users/pjd/_dev/springcloud-helloworld/salutation-service/target/salutation-service-0.0.1-SNAPSHOT.jar &amp;
java -Dserver.port=50203 -jar /Users/pjd/_dev/springcloud-helloworld/salutation-service/target/salutation-service-0.0.1-SNAPSHOT.jar &amp;
</code></pre>
</div>
<footer class=post-footer>
<ul class=post-tags>
</ul>
<nav class=paginav>
<a class=prev href=https://www.pieterjd.be/posts/adventures-with-azure/>
<span class=title>Â« Prev</span>
<br>
<span>Adventures with Microsoft Azure</span>
</a>
<a class=next href=https://www.pieterjd.be/posts/mac-free-tools/>
<span class=title>Next Â»</span>
<br>
<span>Tools for Mac OS I use for easier development</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://www.pieterjd.be>Pieter-Jan Drouillon</a></span>
<span> . </span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerHTML='copy';function d(){a.innerHTML='copied!',setTimeout(()=>{a.innerHTML='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>